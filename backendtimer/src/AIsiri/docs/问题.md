
info: ::1 - - [12/Aug/2025:03:49:50 +0000] "POST /api/ai/process-input HTTP/1.1" 200 1015 "http://localhost:8081/" "Mozilla/5.0 (Linux; Android 13; SM-G981B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Mobile Safari/537.36" {"service":"aisiri-backend","timestamp":"2025-08-12T03:49:50.731Z"}

🔗 AI路由请求: POST /process-input
⏰ 时间: 2025-08-12T03:50:33.318Z
📍 IP: ::1
📦 请求体: {
  "userInput": "我明天打算开始健身",
  "userId": "68974d3a68e7adf1e74f68ab"
}

🌐 === API调用: 处理用户输入 ===
📥 接收到请求:
  - 用户输入: 我明天打算开始健身
  - 用户ID: 68974d3a68e7adf1e74f68ab

🚀 === AI任务处理流程开始 ===
👤 用户ID: 68974d3a68e7adf1e74f68ab
💬 用户输入: 我明天打算开始健身
🎭 分析用户状态: "我明天打算开始健身"
📊 用户状态分析结果: {
  primaryState: 'normal',
  confidence: 0,
  allStates: [],
  needsAdjustment: false
}

📝 步骤1: 分类用户输入...

🔗 === 输入分类 链条开始 ===
📥 输入数据: { userInput: '我明天打算开始健身' }
📝 格式化prompt: input_classifier
🔤 变量: { user_input: '我明天打算开始健身' }
🤖 调用LLM...
📤 输入prompt长度: 425
📥 LLM响应长度: 143
💰 Token使用: {
  prompt_tokens: 229,
  completion_tokens: 68,
  total_tokens: 297,
  prompt_tokens_details: { cached_tokens: 0 }
}
✅ JSON解析成功
✅ 分类成功: goal_planning (置信度: 0.8)
📝 分类原因: 用户表达了开始健身的意图，这通常涉及制定一个长期的计划和分步骤实现目标的过程。虽然健身可以与习惯养成相关，但这里的重点是开始阶段的规划，因此更符合目标规划的类别。
📤 输出结果: {
  category: 'goal_planning',
  confidence: 0.8,
  reason: '用户表达了开始健身的意图，这通常涉及制定一个长期的计划和分步骤实现目标的过程。虽然健身可以与习惯养成相关，但这里的重点是开始阶段的规划，因此更符合目标规划的类别。'
}
🔗 === 输入分类 链条结束 ===


🎯 处理目标规划...
📡 获取用户现有任务: 68974d3a68e7adf1e74f68ab
✅ 成功获取用户任务: 5个任务集, 2个今日任务

❓ 步骤2: 生成问题收集信息...

🔗 === 问题生成 链条开始 ===
📥 输入数据: { userGoal: '我明天打算开始健身', goalType: 'goal_planning', options: {} }
📝 格式化prompt: question_generator
🔤 变量: { user_goal: '我明天打算开始健身', goal_type: 'goal_planning', habit_type: '' }
🤖 调用LLM...
📤 输入prompt长度: 676
📥 LLM响应长度: 130
💰 Token使用: {
  prompt_tokens: 408,
  completion_tokens: 67,
  total_tokens: 475,
  prompt_tokens_details: { cached_tokens: 0 }
}
✅ JSON解析成功
✅ 生成3个问题
❓ 问题1: 是为了减肥、增肌还是保持健康呀？
❓ 问题2: 明天打算练哪些部位或什么运动呢？
❓ 问题3: 以前有健身经验吗，有没有特别喜欢的运动？
📤 输出结果: {
  questions: [ '是为了减肥、增肌还是保持健康呀？', '明天打算练哪些部位或什么运动呢？', '以前有健身经验吗，有没有特别喜欢的运动？' ],
  greeting: '太棒啦，明天一起动起来吧！'
}
🔗 === 问题生成 链条结束 ===

🚀 === AI任务处理流程结束 ===

📤 处理结果: 成功
🌐 === API调用结束 ===

info: ::1 - - [12/Aug/2025:03:50:44 +0000] "POST /api/ai/process-input HTTP/1.1" 200 3000 "http://localhost:8081/" "Mozilla/5.0 (Linux; Android 13; SM-G981B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Mobile Safari/537.36" {"service":"aisiri-backend","timestamp":"2025-08-12T03:50:44.305Z"}

🔗 AI路由请求: POST /generate-plan
⏰ 时间: 2025-08-12T03:52:14.023Z
📍 IP: ::1
📦 请求体: {
  "goal": "我明天打算开始健身",
  "goalType": "goal_planning",
  "userAnswers": [
    "增肌，锻炼背部，之前从来没有过健身",
    "明天我打算锻炼背部明天我打算锻炼背部",
    "从来没有过"
  ],
  "userId": "68974d3a68e7adf1e74f68ab"
}

🌐 === API调用: 生成计划 ===
📥 接收到计划生成请求:
  - 目标: 我明天打算开始健身
  - 类型: goal_planning
  - 回答数量: 3
  - 用户ID: 68974d3a68e7adf1e74f68ab

📋 处理用户回答并生成最终计划...
📡 获取用户现有任务: 68974d3a68e7adf1e74f68ab
✅ 成功获取用户任务: 5个任务集, 2个今日任务

🎯 步骤3: 生成详细计划...

🔗 === 计划生成 链条开始 ===
📥 输入数据: {
  userGoal: '我明天打算开始健身',
  goalType: 'goal_planning',
  userAnswers: [ '增肌，锻炼背部，之前从来没有过健身', '明天我打算锻炼背部明天我打算锻炼背部', '从来没有过' ],
  existingTasks: {
    collections: [ [Object], [Object], [Object], [Object], [Object] ],
    todayTasks: [ [Object], [Object] ],
    occupiedTimeSlots: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object]
    ],
    totalTasks: 18,
    completedTasks: 0
  }
}
📝 格式化prompt: plan_generator
🔤 变量: {
  user_goal: '我明天打算开始健身',
  goal_type: 'goal_planning',
  user_answers: '问题1: 增肌，锻炼背部，之前从来没有过健身\n问题2: 明天我打算锻炼背部明天我打算锻炼背部\n问题3: 从来没有过',
  existing_tasks: '任务集数量: 5\n' +
    '今日任务: 2\n' +
    '总任务数: 18\n' +
    '已完成: 0\n' +
    '\n' +
    '现有任务集:\n' +
    '- 其他: 0/0 已完成\n' +
    '- 健身计划启动: 0/2 已完成\n' +
    '- 每日健身训练: 0/3 已完成\n' +
    '- 饮食管理: 0/2 已完成\n' +
    '- 健身习惯: 0/4 已完成\n' +
    '\n' +
    '今日任务:\n' +
    '⏳ 下午要打个电话 (13:00, 优先级: medium)\n' +
    '⏳ 下午打一个电话 (14:00, 优先级: medium)\n',
  occupied_time_slots: '已占用时间段:\n' +
    '- 2025-04-06 19:00 (制定一周健身计划, 预计60分钟)\n' +
    '- 2025-04-07 14:00 (购买健身装备, 预计60分钟)\n' +
    '- 2025-04-06 18:00 (周一健身训练, 预计60分钟)\n' +
    '- 2025-04-08 18:00 (周三健身训练, 预计60分钟)\n' +
    '- 2025-04-10 18:00 (周五健身训练, 预计60分钟)\n' +
    '- 2025-04-06 19:30 (制定低热量饮食计划, 预计60分钟)\n' +
    '- 2025-04-07 15:00 (购买健康食材, 预计60分钟)\n' +
    '- 2025-08-11 15:00 (明天下午3点要取个快递, 预计60分钟)\n' +
    '- 2025-08-11 13:00 (明天下午要买点菜, 预计60分钟)\n' +
    '- 2025-08-12 13:00 (下午要打个电话, 预计60分钟)\n' +
    '- 2025-08-12 14:00 (下午打一个电话, 预计60分钟)\n'
}
🤖 调用LLM...
📤 输入prompt长度: 1738
📥 LLM响应长度: 4369
💰 Token使用: {
  prompt_tokens: 1043,
  completion_tokens: 1441,
  total_tokens: 2484,
  prompt_tokens_details: { cached_tokens: 0 }
}
✅ JSON解析成功
🔍 验证计划格式...
✅ 计划验证完成，包含4个任务集
📤 输出结果: {
  plan_overview: '用户的目标是明天开始健身，重点在背部增肌。由于用户没有健身经验，计划将从健身准备、训练、饮食管理和习惯养成四个方面入手，确保用户能顺利入门并坚持锻炼。',
  collections: [
    {
      name: '健身计划启动',
      description: '为初次健身者准备基础计划，包括了解健身知识和准备装备。',
      tasks: [Array]
    },
    { name: '每日健身训练', description: '制定并执行首次背部训练计划。', tasks: [Array] },
    { name: '饮食管理', description: '为增肌提供合理的饮食支持。', tasks: [Array] },
    { name: '健身习惯', description: '帮助用户建立长期健身习惯。', tasks: [Array] }
  ],
  suggestions: '请确保在训练前做好热身运动，避免受伤；饮食方面注意蛋白质摄入和水分补充；训练后及时拉伸和休息。同时，避免与已有任务冲突，合理安排时间，保持训练与生活的平衡。'
}
🔗 === 计划生成 链条结束 ===


💾 步骤4: 导入计划到数据库...

🚀 开始执行计划实施...
📁 创建任务集: 健身计划启动
📡 创建任务集: 健身计划启动
✅ 任务集创建成功: 健身计划启动
📡 批量创建任务: 2个
✅ 批量任务创建成功: 2个任务
✅ 成功创建 2 个任务
📁 创建任务集: 每日健身训练
📡 创建任务集: 每日健身训练
✅ 任务集创建成功: 每日健身训练
📡 批量创建任务: 2个
✅ 批量任务创建成功: 2个任务
✅ 成功创建 2 个任务
📁 创建任务集: 饮食管理
📡 创建任务集: 饮食管理
✅ 任务集创建成功: 饮食管理
⏰ 时间冲突解决: 准备健康食材 12:30 → 07:00
📡 批量创建任务: 2个
✅ 批量任务创建成功: 2个任务
✅ 成功创建 2 个任务
📁 创建任务集: 健身习惯
📡 创建任务集: 健身习惯
✅ 任务集创建成功: 健身习惯
📡 批量创建任务: 4个
✅ 批量任务创建成功: 4个任务
✅ 成功创建 4 个任务
🎉 计划实施完成: 4个任务集, 10个任务
📤 计划生成结果: 成功
🌐 === 计划生成API调用结束 ===