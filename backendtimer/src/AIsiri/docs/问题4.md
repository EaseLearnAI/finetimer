📝 步骤1: 分类用户输入...

🔗 === 输入分类 链条开始 ===
📥 输入数据: { userInput: '我想养成每天阅读的习惯' }
📝 格式化prompt: input_classifier
🔤 变量: { user_input: '我想养成每天阅读的习惯' }
🤖 调用LLM...
📤 输入prompt长度: 567
📥 LLM响应长度: 143
💰 Token使用: {
  prompt_tokens: 308,
  completion_tokens: 62,
  total_tokens: 370,
  prompt_tokens_details: { cached_tokens: 0 }
}
✅ JSON解析成功
✅ 分类成功: habit_formation (置信度: 0.95)
📝 分类原因: 用户明确提到‘我想养成每天阅读的习惯’，其中‘养成’和‘每天阅读’是典型的习惯养成关键词，且阅读属于日常重复行为，符合habit_formation的特征。
🏃 习惯类型: 其他
📤 输出结果: {
  category: 'habit_formation',
  confidence: 0.95,
  reason: '用户明确提到‘我想养成每天阅读的习惯’，其中‘养成’和‘每天阅读’是典型的习惯养成关键词，且阅读属于日常重复行为，符合habit_formation的特征。',
  habit_type: '其他'
}
🔗 === 输入分类 链条结束 ===


🔄 处理习惯养成...
📡 获取用户现有任务: 68974d3a68e7adf1e74f68ab
✅ 成功获取用户任务: 28个任务集, 32个今日任务
🎯 识别习惯类型: 其他

🔗 === 问题生成 链条开始 ===
📥 输入数据: {
  userGoal: '我想养成每天阅读的习惯',
  goalType: 'habit_formation',
  options: { habitType: '其他' }
}
✅ 生成3个其他习惯问题
❓ 问题1: 你希望多久做一次这个习惯？
❓ 问题2: 什么时候做比较容易坚持？
❓ 问题3: 担心在坚持过程中会遇到什么困难吗？
📤 输出结果: {
  questions: [ '你希望多久做一次这个习惯？', '什么时候做比较容易坚持？', '担心在坚持过程中会遇到什么困难吗？' ],
  greeting: '想了解一下这个习惯的具体情况，帮你制定合适的计划！',
  habit_type: '其他'
}
🔗 === 问题生成 链条结束 ===

🚀 === AI任务处理流程结束 ===

📤 处理结果: 成功
🌐 === API调用结束 ===

info: ::1 - - [12/Aug/2025:08:04:42 +0000] "POST /api/ai/process-input HTTP/1.1" 200 20176 "http://localhost:8081/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" {"service":"aisiri-backend","timestamp":"2025-08-12T08:04:42.720Z"}

🔗 AI路由请求: GET /health
⏰ 时间: 2025-08-12T08:04:49.638Z
📍 IP: ::1
💓 AI健康检查
info: ::1 - - [12/Aug/2025:08:04:49 +0000] "GET /api/ai/health HTTP/1.1" 200 110 "http://localhost:8081/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" {"service":"aisiri-backend","timestamp":"2025-08-12T08:04:49.653Z"}

🔗 AI路由请求: POST /process-input
⏰ 时间: 2025-08-12T08:04:58.463Z
📍 IP: ::1
📦 请求体: {
  "userInput": "我想养成每天阅读的习惯",
  "userId": "68974d3a68e7adf1e74f68ab"
}

🌐 === API调用: 处理用户输入 ===
📥 接收到请求:
  - 用户输入: 我想养成每天阅读的习惯
  - 用户ID: 68974d3a68e7adf1e74f68ab

🚀 === AI任务处理流程开始 ===
👤 用户ID: 68974d3a68e7adf1e74f68ab
💬 用户输入: 我想养成每天阅读的习惯
🎭 分析用户状态: "我想养成每天阅读的习惯"
📊 用户状态分析结果: {
  primaryState: 'normal',
  confidence: 0,
  allStates: [],
  needsAdjustment: false
}

📝 步骤1: 分类用户输入...

🔗 === 输入分类 链条开始 ===
📥 输入数据: { userInput: '我想养成每天阅读的习惯' }
📝 格式化prompt: input_classifier
🔤 变量: { user_input: '我想养成每天阅读的习惯' }
🤖 调用LLM...
📤 输入prompt长度: 567
📥 LLM响应长度: 125
💰 Token使用: {
  prompt_tokens: 308,
  completion_tokens: 56,
  total_tokens: 364,
  prompt_tokens_details: { cached_tokens: 0 }
}
✅ JSON解析成功
✅ 分类成功: habit_formation (置信度: 0.95)
📝 分类原因: 用户明确提到‘我想养成每天阅读的习惯’，其中‘养成’和‘每天阅读’是典型的习惯养成关键词，且阅读属于常见的日常重复行为。
🏃 习惯类型: 其他
📤 输出结果: {
  category: 'habit_formation',
  confidence: 0.95,
  reason: '用户明确提到‘我想养成每天阅读的习惯’，其中‘养成’和‘每天阅读’是典型的习惯养成关键词，且阅读属于常见的日常重复行为。',
  habit_type: '其他'
}
🔗 === 输入分类 链条结束 ===


🔄 处理习惯养成...
📡 获取用户现有任务: 68974d3a68e7adf1e74f68ab
✅ 成功获取用户任务: 28个任务集, 32个今日任务
🎯 识别习惯类型: 其他

🔗 === 问题生成 链条开始 ===
📥 输入数据: {
  userGoal: '我想养成每天阅读的习惯',
  goalType: 'habit_formation',
  options: { habitType: '其他' }
}
✅ 生成3个其他习惯问题
❓ 问题1: 你希望多久做一次这个习惯？
❓ 问题2: 什么时候做比较容易坚持？
❓ 问题3: 担心在坚持过程中会遇到什么困难吗？
📤 输出结果: {
  questions: [ '你希望多久做一次这个习惯？', '什么时候做比较容易坚持？', '担心在坚持过程中会遇到什么困难吗？' ],
  greeting: '想了解一下这个习惯的具体情况，帮你制定合适的计划！',
  habit_type: '其他'
}
🔗 === 问题生成 链条结束 ===

🚀 === AI任务处理流程结束 ===

📤 处理结果: 成功
🌐 === API调用结束 ===

info: ::1 - - [12/Aug/2025:08:05:00 +0000] "POST /api/ai/process-input HTTP/1.1" 200 20152 "http://localhost:8081/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36" {"service":"aisiri-backend","timestamp":"2025-08-12T08:05:00.538Z"}

🔗 AI路由请求: POST /generate-habit-plan
⏰ 时间: 2025-08-12T08:05:40.742Z
📍 IP: ::1
📦 请求体: {
  "userInput": "我想养成每天阅读的习惯",
  "habitType": "其他",
  "questionAnswers": [
    "每天，下午的时候吧，我看不下去书",
    "下午",
    "看不下去"
  ],
  "userId": "68974d3a68e7adf1e74f68ab"
}

🌐 === API调用: 生成习惯计划 ===
📥 接收到习惯计划生成请求:
  - 用户输入: 我想养成每天阅读的习惯
  - 习惯类型: 其他
  - 回答数量: 3
  - 用户ID: 68974d3a68e7adf1e74f68ab

📋 根据用户回答生成习惯计划...
🎯 习惯目标: 我想养成每天阅读的习惯
📝 习惯类型: 其他
💬 回答数量: 3

🔗 === 习惯处理 链条开始 ===
📥 输入数据: {
  habitGoal: '我想养成每天阅读的习惯',
  userDetails: '习惯类型: 其他\n问题1: 每天，下午的时候吧，我看不下去书\n问题2: 下午\n问题3: 看不下去'
}
📝 格式化prompt: habit_processor
🔤 变量: {
  habit_goal: '我想养成每天阅读的习惯',
  user_details: '习惯类型: 其他\n问题1: 每天，下午的时候吧，我看不下去书\n问题2: 下午\n问题3: 看不下去'
}
🤖 调用LLM...
📤 输入prompt长度: 1192
📥 LLM响应长度: 1199
💰 Token使用: {
  prompt_tokens: 543,
  completion_tokens: 483,
  total_tokens: 1026,
  prompt_tokens_details: { cached_tokens: 0 }
}
✅ JSON解析成功
🔍 验证习惯计划格式...
✅ 习惯计划验证完成
📤 输出结果: {
  habit_analysis: {
    core_behavior: '每天在特定时间段阅读书籍，专注于理解和吸收内容。',
    benefits: [ '提升知识储备和认知能力', '增强专注力和思维能力', '培养持续学习的习惯' ],
    challenges: [ '下午容易感到疲惫，难以集中注意力', '缺乏即时动力，容易拖延', '对阅读内容兴趣不足，导致动力减弱' ]
  },
  implementation_strategy: {
    minimal_viable_habit: '每天下午阅读5分钟',
    trigger_conditions: [ '设置下午特定时间的提醒（如闹钟或日历通知）', '将阅读书本放在显眼的位置，作为视觉提示' ],
    reward_system: '完成每日阅读后可以享受喜欢的零食或娱乐活动',
    tracking_method: '使用习惯追踪App记录每日完成情况，或者在日历上打勾'
  },
  schedule: {
    best_time: '下午（根据用户描述选择适合的时间段）',
    frequency: 'daily',
    duration: '5分钟（初期），逐步增加至30分钟'
  },
  phased_plan: {
    week_1: '建立基础：每天下午阅读5分钟，专注于习惯的启动和完成，不强求阅读量。',
    week_2_4: '稳定执行：将阅读时间增加到15分钟，并选择感兴趣的书籍以提高动力。',
    week_5_8: '深化习惯：阅读时间增加到30分钟，尝试不同类型书籍以扩展视野。',
    long_term: '长期维持：每天固定时间阅读30-60分钟，定期评估阅读内容和效果，保持兴趣和动力。'
  },
  task_template: {
    title: '每日阅读',
    description: '每天下午抽出时间阅读书籍，培养持续学习的习惯。',
    priority: 'medium',
    timeBlock: {
      timeBlockType: 'afternoon',
      startTime: '14:00',
      endTime: '14:30'
    },
    recurrence: 'daily',
    tags: [ 'habit', 'learning' ]
  }
}
🔗 === 习惯处理 链条结束 ===

✅ 创建新任务集: 其他习惯
📡 获取用户现有任务: 68974d3a68e7adf1e74f68ab
✅ 成功获取用户任务: 29个任务集, 32个今日任务
⏰ 时间冲突解决: 每日阅读 14:00 → 21:00
⏰ 时间冲突解决: 每日阅读 - week_1 14:00 → 21:00
⏰ 时间冲突解决: 每日阅读 - week_2_4 14:00 → 21:00
⏰ 时间冲突解决: 每日阅读 - week_5_8 14:00 → 21:00
📡 批量创建任务: 4个
✅ 批量任务创建成功: 4个任务
✅ 习惯计划创建成功，包含4个任务
📤 习惯计划生成结果: 成功