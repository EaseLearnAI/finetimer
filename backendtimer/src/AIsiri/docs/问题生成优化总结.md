# AI任务助手问题生成优化总结

## 优化背景

用户反馈希望AI任务助手在生成考研学习计划时，能够像朋友一样进行简短的提问，而不是长篇大论的问题。

## 优化内容

### 1. Prompt模板优化

**文件位置**: `/src/AIsiri/prompt/question_generator.txt`

**主要改进**:
- 强调"像好朋友一样简单地问几个问题"
- 每个问题控制在20字以内
- 针对考研等具体目标，重点关注院校/专业、时间安排、当前基础
- 语气更加简单亲切，避免正式化表达
- 问候语要求简短友好

**优化前后对比**:

| 方面 | 优化前 | 优化后 |
|------|--------|--------|
| 语气描述 | "像朋友一样自然地问几个问题" | "像好朋友一样简单地问几个问题" |
| 问题长度 | "简洁明了，不要太长" | "每个问题控制在20字以内" |
| 针对性 | 通用性询问角度 | 针对考研等具体目标的专门指导 |
| 问候语 | "自然友好的问候语" | "简短友好的问候语" |

### 2. 架构保持不变

问题生成链条(`QuestionGeneratorChain`)的代码逻辑保持不变，仍然生成3个问题，确保了:
- 系统稳定性
- 向后兼容性
- 测试用例通过

## LangChain架构设计

### 核心设计理念

1. **模块化设计**: 每个链条(Chain)负责特定功能
2. **统一接口**: BaseChain提供统一的LLM调用和错误处理
3. **配置分离**: Prompt模板与代码逻辑分离
4. **可扩展性**: 易于添加新的处理链条

### 架构层次

```
┌─────────────────────────────────────┐
│           AITaskService             │  ← 核心服务层
│        (任务处理协调器)              │
└─────────────────────────────────────┘
                    │
┌─────────────────────────────────────┐
│              Chains                 │  ← 处理链条层
│  ┌─────────────────────────────────┐ │
│  │ InputClassifierChain            │ │  ← 输入分类
│  │ QuestionGeneratorChain          │ │  ← 问题生成
│  │ PlanGeneratorChain              │ │  ← 计划生成
│  │ PlanAdjusterChain               │ │  ← 计划调整
│  │ HabitProcessorChain             │ │  ← 习惯处理
│  └─────────────────────────────────┘ │
└─────────────────────────────────────┘
                    │
┌─────────────────────────────────────┐
│             BaseChain               │  ← 基础链条类
│        (LLM调用 + 错误处理)          │
└─────────────────────────────────────┘
                    │
┌─────────────────────────────────────┐
│     Config + Prompt + Models        │  ← 配置和数据层
│  ┌─────────────┬─────────────────┐   │
│  │ LLMConfig   │ Prompt Templates│   │
│  │ PromptLoader│ Task/Collection │   │
│  └─────────────┴─────────────────┘   │
└─────────────────────────────────────┘
```

### 处理流程

1. **输入分类** → 判断用户意图(简单待办/目标规划/习惯养成)
2. **问题生成** → 根据分类生成针对性问题
3. **回答收集** → 收集用户回答
4. **计划生成** → 基于回答生成详细计划
5. **任务保存** → 将计划转换为具体任务保存到数据库

### 关键特性

- **错误降级**: 每个环节都有Mock模式和默认策略
- **测试友好**: 支持完整的单元测试和集成测试
- **配置灵活**: 通过环境变量控制Mock/真实模式
- **日志完整**: 详细的处理日志便于调试

## 测试验证

运行测试命令验证优化效果:
```bash
cd /Users/bytedance/Desktop/coding/AIsiri/backendtimer/src/AIsiri/tests
node run_tests.js
```

**测试结果**: ✅ 所有AI功能测试通过

## 使用示例

**用户输入**: "我想制定考研学习计划"

**优化后的问题生成** (预期效果):
1. "目标院校和专业是什么？" (15字)
2. "每天能学几个小时？" (10字)
3. "哪些科目需要重点复习？" (12字)

**问候语**: "嗨～一起规划考研吧！" (9字)

## 后续改进建议

1. **个性化问题**: 根据用户历史记录调整问题
2. **动态问题数量**: 根据目标复杂度调整问题数量
3. **情感分析**: 根据用户情绪调整语气
4. **多轮对话**: 支持追问和澄清

## 总结

本次优化成功实现了:
- ✅ 问题更简洁友好(20字以内)
- ✅ 语气更像朋友聊天
- ✅ 针对考研等具体场景优化
- ✅ 保持系统架构稳定性
- ✅ 通过完整测试验证

通过Prompt模板的精细调整，在不改变代码架构的前提下，显著提升了用户体验，体现了LangChain架构设计的灵活性和可维护性。